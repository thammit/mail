3.0.0 - 14th Aug. 2024
======================


.. contents::
        :local:
        :depth: 3



Recipient list refactoring
--------------------------

Add more possibilities to manipulate recipient groups using query restrictions on table or extbase model based recipient sources.

New features
------------

 - Add RecipientsRestrictionEvent to manipulate querys of extbase model recipient sources. This way it is now possible to e.g. filter recipient lists coming from extbase.

   See here how to use:
    - https://gitlab.com/mediaessenz/additional-mail-recipients/-/blob/main/Configuration/Site/RecipientSources.yaml (recipientSources:male_tt_address)
    - https://gitlab.com/mediaessenz/additional-mail-recipients/-/blob/main/Classes/EventListener/AddressModelRestriction.php
    - https://gitlab.com/mediaessenz/additional-mail-recipients/-/blob/main/Classes/Domain/Model/Address.php
    - https://gitlab.com/mediaessenz/additional-mail-recipients/-/blob/main/Classes/Domain/Repository/AddressRepository.php
    - https://gitlab.com/mediaessenz/additional-mail-recipients/-/blob/main/Configuration/Extbase/Persistence/Classes.php
    - https://gitlab.com/mediaessenz/additional-mail-recipients/-/blob/main/Configuration/Services.yaml

 - Add possibility to define one or more query restrictions to manipulate table recipient sources. This way it is now possible to e.g. filter recipient lists coming from tables.
   See here how to use:
    - https://gitlab.com/mediaessenz/additional-mail-recipients/-/blob/main/Configuration/Site/RecipientSources.yaml (recipientSources:female_tt_address)
    - https://gitlab.com/mediaessenz/additional-mail-recipients/-/blob/main/Classes/Database/Query/Restriction/FemaleRestriction.php

 - To make it possible to use a table more than ones, a new recipient source confiiguration property `table` was added.
   If not set, the identifier is used as table name instead.

Breaking changes
----------------

 - Recipient Source Configurations now uses the DTO `MEDIAESSENZ\\Domain\\Model\\Dto\\RecipientSourceConfigurationDTO`.
   Previously the getRecipientSourceConfiguration method of the following events returns an array:

    - ManipulateMarkersEvent
    - ManipulateRecipientEvent
    - DeactivateRecipientEvent

   Please adjust your event listeners to use e.g. `$recipientsSourceConfiguration->table` instead of `$recipientsSourceConfiguration->['table']`.
   There is also a `custom` property available to tranfer custom yaml config into event listeners.

   ```yaml
   mail:
     recipientSources:
       myCustomDataSource:
         custom:
           foo: bar
   ```

   This will be available as `$recipientsSourceConfiguration->custom['foo']` in an event listener.

 - Plain Lists and CSV recipient groups are now different recipient group type. A migration wizard to convert from old to new format is included.
   Attention: Before using the migration wizard please do a database compare, but do **not** rename or remove the field "csv" in the first step!
   After the new fields "csv_type", "csv_data", "csv_separator" and "csv_file" (not used yet) have been generated with help of the database compare,
   got to admin tools > upgrade and click on upgrade wizard. Here start the wizard with the title: "EXT:mail: Migrate mail group type plain to plain or new group csv, depending on csv type."

