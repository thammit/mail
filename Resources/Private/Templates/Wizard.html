<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"
      xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:mail="http://typo3.org/ns/MEDIAESSENZ/Mail/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Default"/>

<f:section name="content">
    {_all -> f:debug(inline:1)}
    {be:arrayBrowser(data:settings)}
    <f:variable name="lll" value="LLL:EXT:mail/Resources/Private/Language/locallang_mod2-6.xlf:"/>
    <h1><f:translate key="{lll}dmail_wizard_title"/></h1>
    <f:render partial="Wizard/Steps" arguments="{navigation: data.navigation}"/>
    <f:if condition="{data.default}">
        <h3>
            <f:translate key="{lll}dmail_wiz1_new_newsletter"/>
            -
            <f:translate key="{lll}dmail_wiz1_select_nl_source"/>
        </h3>
        <div class="panel-group" id="mail-wizard-source-select-panel">
            <f:if condition="{data.default.dmail.data}">
                <f:variable name="counter" value="{data.default.dmail.data -> f:count()}"/>
                <f:render partial="Wizard/Panel" arguments="{lll:lll, parentId:'mail-wizard-source-select-panel', title: 'dmail_wiz1_list_dmail', index:7, counter: counter}" contentAs="panelBody">
                    <f:render section="OpenMailsPanel" arguments="{lll:lll, data: data.default.dmail}" />
                </f:render>
            </f:if>
            <f:if condition="{data.default.internal}">
                <f:variable name="counter" value="{data.default.internal.internalPages -> f:count()}"/>
                <f:render partial="Wizard/Panel" arguments="{lll:lll, parentId:'mail-wizard-source-select-panel', title: 'dmail_wiz1_internal_page', index:4, counter: counter}" contentAs="panelBody">
                    <f:render section="InternalPanel" arguments="{lll:lll, data: data.default.internal}" />
                </f:render>
            </f:if>
            <f:if condition="{data.default.external}">
                <f:render partial="Wizard/Panel" arguments="{lll:lll, parentId:'mail-wizard-source-select-panel', title: 'dmail_wiz1_external_page', index:5, counter: 0}" contentAs="panelBody">
                    <f:render section="ExternalPanel" arguments="{lll:lll, settings: settings, data: data.default.external}" />
                </f:render>
            </f:if>
            <f:if condition="{data.default.quick}">
                <f:render partial="Wizard/Panel" arguments="{lll:lll, parentId:'mail-wizard-source-select-panel', title: 'dmail_wiz1_quickmail', index:6, counter: 0}" contentAs="panelBody">
                    <f:render section="QuickMailPanel" arguments="{lll:lll, settings: settings, data: data.default.quick}" />
                </f:render>
            </f:if>
        </div>
    </f:if>
    <f:if condition="{data.info}">
        <f:render partial="Wizard/Settings" arguments="{_all}"/>
    </f:if>
    <f:if condition="{data.cats}">
        <f:render partial="Wizard/Categories" arguments="{_all}"/>
    </f:if>
    <f:if condition="{data.test}">
        <f:render partial="Wizard/SendTestMail" arguments="{_all}"/>
    </f:if>
    <f:if condition="{data.final.finalForm}">
        <f:render partial="Wizard/ScheduleMassSending" arguments="{_all}"/>
    </f:if>
</f:section>

<f:section name="OpenMailsPanel">
    <table class="table table-striped table-hover">
        <thead class="table-light">
        <tr>
            <th style="width: 1%">&nbsp;</th>
            <th class="col-title col-responsive nowrap"><f:translate key="{lll}nl_l_subject"/></th>
            <th><f:translate key="{lll}nl_l_type"/></th>
            <th><f:translate key="{lll}nl_l_lastM"/></th>
            <th><f:translate key="{lll}nl_l_size"/></th>
            <th><f:translate key="{lll}nl_l_attach"/></th>
            <th><f:translate key="{lll}nl_l_sent"/></th>
            <th class="col-control nowrap"></th>
            <th class="col-control nowrap"></th>
        </tr>
        </thead>
        <tbody>
        <f:for each="{data.data}" as="row">
            <tr>
                <td class="col-icon nowrap" style="width: 1%">
                    <core:iconForRecord row="{row}" table="sys_dmail"/>
                </td>
                <td class="col-title col-responsive nowrap"><a class="t3-link" href="{row.settingsUri}">
                    {row.subject}
                </a></td>
                <td class="nowrap">{row.type}</td>
                <td class="nowrap">{row.tstamp -> f:format.date(format:'H:i d-m-Y')}</td>
                <td class="nowrap">{row.size -> f:format.bytes()}</td>
                <td class="nowrap"><f:if condition="{row.hasAttachment}">
                    <core:icon identifier="mail-attachment" size="small"/>
                </f:if></td>
                <td><f:if condition="{row.isSent}">
                    <core:icon identifier="status-status-checked" size="small"/>
                </f:if></td>
                <td class="nowrap">
                    <f:if condition="{row.deleteUri}"><a class="btn btn-default" title="delete" href="{row.deleteUri}"><core:icon identifier="actions-edit-delete" size="small"/></a></f:if>
                </td>
                <td class="col-control nowrap">
                    <f:be.link route="{settings.route}" parameters="{id: settings.mailSysFolderUid, cmd: settings.steps.settings, sys_dmail_uid: row.uid, fetchAtOnce: 1}" class="btn btn-primary">NEXT</f:be.link>
                </td>
            </tr>
        </f:for>
        </tbody>
    </table>
</f:section>

<f:section name="InternalPanel">
    <f:if condition="{data.internalPages}">
        <f:then>
            <f:render partial="InfoBox" arguments="{field: 'select_newsletter'}" />
            <table class="table table-striped table-hover">
                <thead class="table-light">
                <tr>
                    <th style="width: 1%"></th>
                    <th class="col-title col-responsive nowrap">Page</th>
                    <th class="nowrap"></th>
                    <th class="col-control nowrap"></th>
                </tr>
                </thead>
                <tbody>
                <f:for each="{data.internalPages}" as="row">
                    <tr class="db_list_normal">
                        <td class="col-icon nowrap" style="width: 1%"><core:iconForRecord row="{row}" table="sys_dmail"/></td>
                        <td class="col-title col-responsive nowrap">{row.title}</td>
                        <td class="nowrap">
                            <be:link.editRecord uid="{row.uid}" table="pages" class="btn btn-default" title="{f:translate(key: '{lll}nl_editPage')}">
                                <core:icon identifier="actions-open" size="small"/>
                            </be:link.editRecord>
                            <f:for each="{row.previewLinks}" as="previewLinks" key="type">
                                <f:if condition="{type} == 'htmlPreview'">
                                    <f:variable name="addIconOverlay" value="0" />
                                    <f:if condition="{previewLinks -> f:count()} > 1">
                                        <f:variable name="addIconOverlay" value="1" />
                                    </f:if>
                                    <f:for each="{previewLinks}" as="htmlPreviewLink">
                                        <f:variable name="overlay" value="" />
                                        <f:if condition="{addIconOverlay}">
                                            <f:variable name="iconOverlay" value="{htmlPreviewLink.data-flag-icon}" />
                                        </f:if>
                                        <a href="#" class="btn btn-default" title="{htmlPreviewLink.title}" data-dispatch-action="{htmlPreviewLink.data-dispatch-action}" data-dispatch-args="{htmlPreviewLink.data-dispatch-args}"><core:icon identifier="mail-preview-html" overlay="{iconOverlay}" size="small"/></a>
                                    </f:for>
                                </f:if>
                                <f:if condition="{type} == 'textPreview'">
                                    <f:variable name="addIconOverlay" value="0" />
                                    <f:if condition="{previewLinks -> f:count()} > 1">
                                        <f:variable name="addIconOverlay" value="1" />
                                    </f:if>
                                    <f:for each="{previewLinks}" as="textPreviewLink">
                                        <f:variable name="overlay" value="" />
                                        <f:if condition="{addIconOverlay}">
                                            <f:variable name="iconOverlay" value="{textPreviewLink.data-flag-icon}" />
                                        </f:if>
                                        <a href="#" class="btn btn-default" title="{textPreviewLink.title}" data-dispatch-action="{textPreviewLink.data-dispatch-action}" data-dispatch-args="{textPreviewLink.data-dispatch-args}"><core:icon identifier="mail-preview-text" overlay="{iconOverlay}" size="small"/></a>
                                    </f:for>
                                </f:if>
                            </f:for>
                        </td>
                        <td class="col-control nowrap">
                            <f:be.link route="{settings.route}" parameters="{id: settings.mailSysFolderUid, cmd: settings.steps.settings, createMailFrom_UID: row.uid, fetchAtOnce: 1}" class="btn btn-primary">NEXT</f:be.link>
                        </td>
                    </tr>
                </f:for>
                </tbody>
            </table>
        </f:then>
        <f:else>
            <f:be.infobox state="-1" title="{f:translate(key: '{lll}nl_select')}">
                <f:translate key="{lll}nl_select_msg1"/>
            </f:be.infobox>
        </f:else>
    </f:if>
</f:section>

<f:section name="ExternalPanel">
    <f:render partial="InfoBox" arguments="{field: 'create_directmail_from_url'}" />
    <form action="" method="post" name="dmailform" enctype="multipart/form-data">
        <input type="hidden" name="cmd" value="info"/>
        <input type="hidden" name="fetchAtOnce" value="1">
        <div class="mb-3">
            <label for="createMailFrom_HTMLUrl" class="form-label"><f:translate key="{lll}dmail_HTML_url"/></label>
            <input id="createMailFrom_HTMLUrl" type="url" placeholder="https://" name="createMailFrom_HTMLUrl" class="form-control"/>
        </div>
        <div class="mb-3">
            <label for="createMailFrom_plainUrl" class="form-label"><f:translate key="{lll}dmail_plaintext_url"/></label>
            <input id="createMailFrom_plainUrl" type="url" placeholder="https://" name="createMailFrom_plainUrl" class="form-control"/>
        </div>
        <div class="mb-3">
            <label for="createMailSubject" class="form-label"><f:translate key="{lll}dmail_subject"/></label>
            <input id="createMailSubject" type="text" placeholder="{f:translate(key: '{lll}dmail_write_subject')}" name="createMailFrom_URL" class="form-control" required/>
        </div>
        <f:if condition="{data.no_valid_url}">
            <f:be.infobox title="Error" state="2"><f:translate key="{lll}dmail_no_valid_url"/></f:be.infobox>
        </f:if>
        <button class="btn btn-primary text-uppercase" type="submit" value="1"><f:translate key="{lll}dmail_wiz_next" /></button>
    </form>
</f:section>

<f:section name="QuickMailPanel">
    <f:render partial="InfoBox" arguments="{field: 'quick_mail'}" />
    <form action="" method="post" name="dmailform" enctype="multipart/form-data">
        <input type="hidden" name="cmd" value="info"/>
        <input type="hidden" name="id" value="{data.id}"/>
        <div class="mb-3">
            <label for="quickmailSenderName" class="form-label"><f:translate key="{lll}quickmail_sender_name"/></label>
            <input id="quickmailSenderName" type="text" name="quickmail[senderName]" value="{data.senderName}" class="form-control" required/>
        </div>
        <div class="mb-3">
            <label for="quickmailSenderEmail" class="form-label"><f:translate key="{lll}quickmail_sender_email"/></label>
            <input id="quickmailSenderEmail" type="email" name="quickmail[senderEmail]" value="{data.senderMail}" class="form-control" required/>
        </div>
        <div class="mb-3">
            <label for="quickmailSubject" class="form-label"><f:translate key="{lll}dmail_subject"/></label>
            <input id="quickmailSubject" type="text" name="quickmail[subject]" value="{data.subject}" class="form-control" required/>
        </div>
        <div class="mb-3">
            <label for="quickmailMessage" class="form-label"><f:translate key="{lll}quickmail_message"/></label>
            <textarea id="quickmailMessage" rows="10" name="quickmail[message]" class="form-control">{data.message -> f:format.html()}</textarea>
        </div>
        <div class="form-check mb-3">
            <input id="quickmailBreakLines" class="form-check-input mt-1" type="checkbox" name="quickmail[breakLines]" value="1" {f:if(condition: '{data.breakLines}', then: 'checked')} />
            <label for="quickmailBreakLines" class="form-check-label"><f:translate key="{lll}quickmail_break_lines"/></label>
        </div>
        <button class="btn btn-primary text-uppercase" type="Submit" name="quickmail[send]" value="1"><f:translate key="{lll}dmail_wiz_next" /></button>
    </form>
</f:section>

</html>
