<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"
      xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:mail="http://typo3.org/ns/MEDIAESSENZ/Mail/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:variable name="lll2" value="LLL:EXT:mail/Resources/Private/Language/locallang_tca.xlf:"/>

<f:variable name="fromInfo" value="{
        0: '{f:translate(key:\'{lll}report.replyTo\')}: {mail.replytoName} {mail.replyToEmail}',
        1: '{f:translate(key:\'{lll2}tx_mail_domain_model_mail.organisation\')}: {mail.organisation}',
        2: '{f:translate(key:\'{lll2}tx_mail_domain_model_mail.returnPath\')}: {mail.returnPath}'}"/>

<f:variable name="sourceInfo" value="{
        0: '{f:translate(key:\'{lll}report.general.htmlSource\')}: {data.htmlSource}',
        1: '{f:translate(key:\'{lll}report.general.plainSource\')}: {data.plainSource}'
        }"/>

<f:variable name="mailFormatAttachementInfo" value="{
        0: '{f:translate(key:\'{lll2}tx_mail_domain_model_mail.priority\')}: {mail.priority}',
        1: '{f:translate(key:\'{lll2}tx_mail_domain_model_mail.charset\')}: {mail.charset}',
        2: '{f:translate(key:\'{lll}report.includeMedia\')}: {data.includeMedia}'
        }"/>

<h2>
    <f:translate key="{lll}report.mail"/>
</h2>
<div class="panel panel-default mb-3">
    <div class="table-fit">
        <table class="table table-striped table-hover">
            <tr>
                <th>
                    <f:translate key="{lll}report.from"/>
                </th>
                <td>{mail.fromName} &lt;{mail.fromEmail}&gt;</td>
                <td>
                    <f:render section="help" arguments="{messages: fromInfo}"/>
                </td>
            </tr>
            <tr>
                <th>
                    <f:translate key="{lll}report.source"/>
                </th>
                <td>
                    <f:if condition="{mail.quickMail}">
                        <f:then><f:translate key="{lll}mail.type.quickMail"/></f:then>
                        <f:else>
                            <f:translate key="{lll2}tx_mail_domain_model_mail.type.I.{mail.type}"/>
                        </f:else>
                    </f:if>
                    <f:if condition="{mail.internal}">[{mail.page}]</f:if>
                </td>
                <td>
                    <f:render section="help" arguments="{messages: sourceInfo}"/>
                </td>
            </tr>
            <tr>
                <th>
                    <f:translate key="{lll}report.formatAttachments"/>
                </th>
                <td>
                    {data.sendOptions}
                    <f:if condition="{mail.attachment}">
                        <f:for each="{mail.attachment}" as="attachment">
                            {attachment.originalResource.name}
                        </f:for>
                    </f:if>
                </td>
                <td>
                    <f:render section="help" arguments="{messages: mailFormatAttachementInfo}"/>
                </td>
            </tr>
            <tr>
                <th>
                    <f:translate key="{lll}report.deliveryBeginEnd"/>
                </th>
                <td>{mail.scheduledBegin -> f:format.date(format: 'd.m.Y H:i')} / {mail.scheduledEnd ->
                    f:format.date(format: 'd.m.Y H:i')}
                </td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <th>
                    <f:translate key="{lll}report.general.groups"/>
                </th>
                <td><f:for each="{mail.recipientGroups}" as="recipientGroup" iteration="recipientIterator">{recipientGroup.title}<f:if condition="!{recipientIterator.isLast}">, </f:if></f:for></td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <th>
                    <f:translate key="{lll}report.recipients"/>
                </th>
                <td>{mail.numberOfRecipients}</td>
                <td>&nbsp;</td>
            </tr>
        </table>
    </div>
</div>

<f:section name="help">
    <f:variable name="tooltip">
        <f:for each="{messages}" as="message">
            {message}<br>
        </f:for>
    </f:variable>
    <span class="badge rounded-pill bg-mail-theme mb-1 ms-1" data-bs-trigger="hover focus" data-bs-container="body"
          data-bs-toggle="popover" data-bs-html="true"
          data-bs-placement="right" data-bs-content="{tooltip -> f:format.raw()}">
        i
    </span>
</f:section>
</html>
