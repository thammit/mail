<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"
      xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:mail="http://typo3.org/ns/MEDIAESSENZ/Mail/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:variable name="lll2" value="LLL:EXT:mail/Resources/Private/Language/locallang_tca.xlf:"/>

<f:variable name="mailFormatAttachementInfo" value="{
        0: '{f:translate(key:\'{lll2}sys_dmail.priority\')}: {mailInfo.mail.priority}',
        1: '{f:translate(key:\'{lll2}sys_dmail.transfer_encoding\')}: {mailInfo.mail.encoding}',
        2: '{f:translate(key:\'{lll2}sys_dmail.charset\')}: {mailInfo.mail.charset}'
}"/>

<f:variable name="sourceInfo" value="{
        0: '{f:translate(key:\'{lll}view_media\')}: {mailInfo.includeMedia}',
        1: '{f:translate(key:\'{lll}view_flowed\')}: {mailInfo.flowedFormat}'
}"/>

<f:variable name="fromInfo" value="{
        0: '{f:translate(key:\'{lll}view_replyto\')}: {mailInfo.mail.replytoName} {mailInfo.mail.replyToEmail}',
        1: '{f:translate(key:\'{lll2}sys_dmail.organisation\')}: {mailInfo.mail.organisation}',
        2: '{f:translate(key:\'{lll2}sys_dmail.return_path\')}: {mailInfo.mail.returnPath}'
}"/>

<h2>
    <f:translate key="{lll}stats_direct_mail"/>
</h2>
<div class="panel panel-default mb-3">
    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th colspan="3">
                <core:iconForRecord row="{uid: mailInfo.mail.uid, type: 0}" table="tx_mail_domain_model_mail" size="small" /> {mailInfo.mail.subject}
            </th>
        </tr>
        </thead>
        <tr>
            <th>
                <f:translate key="{lll}view_from"/>
            </th>
            <td>{mailInfo.mail.fromName} &lt;{mailInfo.mail.fromEmail}&gt;</td>
            <td><f:render section="help" arguments="{fromInfo}"/></td>
        </tr>
        <tr>
            <th>
                <f:translate key="{lll}view_dmail"/>
            </th>
            <td>{mailInfo.type}{mailInfo.dmailData}</td>
            <td><f:render section="help" arguments="{sourceInfo}"/></td>
        </tr>
        <tr>
            <th>
                <f:translate key="{lll}view_mail"/>
            </th>
            <td>
                {mailInfo.sendOptions}
                <f:if condition="{mailInfo.mail.attachment}">
                    <f:for each="{mailInfo.mail.attachment}" as="attachment">
                        {attachment -> f:debug(inline:1)}
                    </f:for>
                </f:if>
            </td>
            <td><f:render section="help" arguments="{mailFormatAttachementInfo}"/></td>
        </tr>
        <tr>
            <th>
                <f:translate key="{lll}view_delivery_begin_end"/>
            </th>
            <td>{mailInfo.mail.scheduledBegin -> f:format.date(format: 'd.m.Y h:i')} / {mailInfo.mail.scheduledEnd -> f:format.date(format: 'd.m.Y h:i')}</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <th>
                <f:translate key="{lll}view_recipient_total_sent"/>
            </th>
            <td>{mailInfo.recipients} / {mailInfo.sentRecipients}</td>
            <td>&nbsp;</td>
        </tr>
    </table>
</div>

<f:section name="help">
    <f:variable name="tooltip">
        <f:for each="{_all}" as="message">
            <f:if condition="{message}">
                {message}<br>
            </f:if>
        </f:for>
    </f:variable>
    <span class="badge rounded-pill bg-primary mb-1 ms-1" data-bs-trigger="hover focus" data-bs-container="body" data-bs-toggle="popover" data-bs-html="true" data-bs-placement="right" data-bs-content="{tooltip -> f:format.html()}">
        i
    </span>
</f:section>
</html>
