<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"
      xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:mail="http://typo3.org/ns/MEDIAESSENZ/Mail/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Default"/>

<f:section name="content">
    <f:variable name="lll" value="LLL:EXT:mail/Resources/Private/Language/locallang_mod2-6.xlf:"/>
    <h1>
        <f:translate key="{lll}stats_overview_header"/>
    </h1>
    <p>
        <f:link.action action="recalculateCache" arguments="{mail:mailInfo.mail.uid}" class="btn btn-default text-uppercase"><core:icon identifier="actions-refresh"/> <f:translate key="{lll}stats_recalculate_stats"/></f:link.action>
    </p>

    <div class="row">
        <div class="col-12 col-lg-6 col-xxl-4">
            <f:render partial="Report/CompactView" arguments="{mailInfo:mailInfo, lll:lll}"/>
        </div>
        <f:if condition="{generalInfo}">
            <div class="col-12 col-lg-6 col-xxl-4">
                <h2>
                    <f:translate key="{lll}stats_general_information"/>
                </h2>
                <f:render section="table" arguments="{table:generalInfo.table, lll:lll}"/>
            </div>
        </f:if>
        <f:if condition="{responsesInfo}">
            <div class="col-12 col-lg-6 col-xxl-4">
                <h2>
                    <f:translate key="{lll}stats_response"/>
                </h2>
                <f:render section="table" arguments="{table:responsesInfo, lll:lll}"/>
            </div>
        </f:if>
        <f:if condition="{dataStats.tables.4}">
            <div class="col-12 col-lg-6 col-xxl-4">
                <h2>
                    <f:translate key="{lll}stats_mails_returned"/>
                </h2>
                <f:render section="ReturnedMails" arguments="{table:dataStats.tables.4, lll:lll}"/>
            </div>
        </f:if>
    </div>


    <f:if condition="{dataStats.tables.5}">
        <h2>
            <f:translate key="{lll}stats_response_link"/>
        </h2>
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <f:for each="{dataStats.tables.5.head}" as="head">
                    <th>
                        <f:if condition="{head}">
                            <f:translate key="{lll}{head}"/>
                        </f:if>
                    </th>
                </f:for>
            </tr>
            </thead>
            <tbody>
            <f:for each="{dataStats.tables.5.body}" as="body">
                <tr>
                    <f:for each="{body}" as="cell" iteration="fooIterator">
                        <f:if condition="{fooIterator.isFirst}">
                            <f:then>
                                <th>
                            </f:then>
                            <f:else>
                                <td>
                            </f:else>
                        </f:if>
                        <f:format.html>{cell}</f:format.html>
                        <f:if condition="{fooIterator.isFirst}">
                            <f:then>
                                </th>
                            </f:then>
                            <f:else>
                                </td>
                            </f:else>
                        </f:if>
                    </f:for>
                </tr>
            </f:for>
            </tbody>
        </table>
    </f:if>

    <f:if condition="{dataStats.tables.6}">
        <f:variable name="stats_emails" value="{f:translate(key: '{lll}stats_emails')}"/>
        <f:variable name="stats_website_users" value="{f:translate(key: '{lll}stats_website_users')}"/>
        <f:variable name="stats_plainlist" value="{f:translate(key: '{lll}stats_plainlist')}"/>
        <f:variable name="stats_emails_disabled" value="{f:translate(key: '{lll}stats_emails_disabled')}"/>
        <f:variable name="stats_website_users_disabled"
                    value="{f:translate(key: '{lll}stats_website_users_disabled')}"/>

        <f:comment>returnList</f:comment>

        <f:if condition="{dataStats.tables.6.returnList.tt_address}">
            <h3>{stats_emails}</h3>
            <f:render arguments="{table: dataStats.tables.6.returnList.tt_address, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.returnList.fe_users}">
            <h3>{stats_website_users}</h3>
            <f:render arguments="{table: dataStats.tables.6.returnList.fe_users, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.returnList.PLAINLIST}">
            <h3>{stats_plainlist}</h3>
            <ul>
                <li>
                    <f:format.html>{dataStats.tables.6.returnList.PLAINLIST.PLAINLIST}</f:format.html>
                </li>
            </ul>
        </f:if>

        <f:comment>returnDisable</f:comment>

        <f:if condition="{dataStats.tables.6.returnDisable.tt_address}">
            <br/>
            {dataStats.tables.6.returnDisable.tt_address.rows -> f:count()} {stats_emails_disabled}
        </f:if>
        <f:if condition="{dataStats.tables.6.returnDisable.fe_users}">
            <br/>
            {dataStats.tables.6.returnDisable.fe_users.rows -> f:count()} {stats_website_users_disabled}
        </f:if>

        <f:comment>returnCSV</f:comment>

        <f:if condition="{dataStats.tables.6.returnCSV}">
            <div class="mb-3">
                <label for="statisticsReturnCSV" class="form-label">
                    <f:translate key="{lll}stats_emails_returned_list"/>
                </label>
                <textarea class="form-control" rows="6" id="statisticsReturnCSV" name="nothing"><f:format.html>{dataStats.tables.6.returnCSV.text}</f:format.html></textarea>
            </div>
        </f:if>

        <f:comment>unknownList</f:comment>

        <f:if condition="{dataStats.tables.6.unknownList.tt_address}">
            <br/>
            {stats_emails}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.unknownList.tt_address, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.unknownList.fe_users}">
            <br/>
            {stats_website_users}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.unknownList.fe_users, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.unknownList.PLAINLIST}">
            <h3>{stats_plainlist}</h3>
            <ul>
                <li>
                    <f:format.html>{dataStats.tables.6.unknownList.PLAINLIST.PLAINLIST}</f:format.html>
                </li>
            </ul>
        </f:if>

        <f:comment>unknownDisable</f:comment>

        <f:if condition="{dataStats.tables.6.unknownDisable.tt_address}">
            <br/>
            {dataStats.tables.6.unknownDisable.tt_address.rows -> f:count()} {stats_emails_disabled}
        </f:if>
        <f:if condition="{dataStats.tables.6.unknownDisable.fe_users}">
            <br/>
            {dataStats.tables.6.unknownDisable.fe_users.rows -> f:count()} {stats_website_users_disabled}
        </f:if>

        <f:comment>unknownCSV</f:comment>

        <f:if condition="{dataStats.tables.6.unknownCSV}">
            <br/>
            <f:translate key="{lll}stats_emails_returned_unknown_recipient_list"/>
            <br/>
            <textarea style="width:460px;" rows="6" name="nothing"><f:format.html>{dataStats.tables.6.unknownCSV.text}</f:format.html></textarea>
        </f:if>

        <f:comment>fullList</f:comment>

        <f:if condition="{dataStats.tables.6.fullList.tt_address}">
            <br/>
            {stats_emails}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.fullList.tt_address, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.fullList.fe_users}">
            <br/>
            {stats_website_users}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.fullList.fe_users, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.fullList.PLAINLIST}">
            <br/>
            {stats_plainlist}
            <ul>
                <li>
                    <f:format.html>{dataStats.tables.6.fullList.PLAINLIST.PLAINLIST}</f:format.html>
                </li>
            </ul>
        </f:if>

        <f:comment>fullDisable</f:comment>

        <f:if condition="{dataStats.tables.6.fullDisable.tt_address}">
            <br/>
            {dataStats.tables.6.fullDisable.tt_address.rows -> f:count()} {stats_emails_disabled}
        </f:if>
        <f:if condition="{dataStats.tables.6.fullDisable.fe_users}">
            <br/>
            {dataStats.tables.6.fullDisable.fe_users.rows -> f:count()} {stats_website_users_disabled}
        </f:if>

        <f:comment>fullCSV</f:comment>

        <f:if condition="{dataStats.tables.6.fullCSV}">
            <br/>
            <f:translate key="{lll}stats_emails_returned_mailbox_full_list"/>
            <br/>
            <textarea style="width:460px;" rows="6" name="nothing"><f:format.html>{dataStats.tables.6.fullCSV.text}</f:format.html></textarea>
        </f:if>

        <f:comment>badHostList</f:comment>

        <f:if condition="{dataStats.tables.6.badHostList.tt_address}">
            <br/>
            {stats_emails}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.badHostList.tt_address, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.badHostList.fe_users}">
            <br/>
            {stats_website_users}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.badHostList.fe_users, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.badHostList.PLAINLIST}">
            <br/>
            {stats_plainlist}
            <ul>
                <li>
                    <f:format.html>{dataStats.tables.6.badHostList.PLAINLIST.PLAINLIST}</f:format.html>
                </li>
            </ul>
        </f:if>

        <f:comment>badHostDisable</f:comment>

        <f:if condition="{dataStats.tables.6.badHostDisable.tt_address}">
            <br/>
            {dataStats.tables.6.badHostDisable.tt_address.rows -> f:count()} {stats_emails_disabled}
        </f:if>
        <f:if condition="{dataStats.tables.6.badHostDisable.fe_users}">
            <br/>
            {dataStats.tables.6.badHostDisable.fe_users.rows -> f:count()} {stats_website_users_disabled}
        </f:if>

        <f:comment>badHostCSV</f:comment>

        <f:if condition="{dataStats.tables.6.badHostCSV}">
            <br/>
            <f:translate key="{lll}stats_emails_returned_bad_host_list"/>
            <br/>
            <textarea style="width:460px;" rows="6" name="nothing"><f:format.html>{dataStats.tables.6.badHostCSV.text}</f:format.html></textarea>
        </f:if>

        <f:comment>badHeaderList</f:comment>

        <f:if condition="{dataStats.tables.6.badHeaderList.tt_address}">
            <br/>
            {stats_emails}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.badHeaderList.tt_address, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.badHeaderList.fe_users}">
            <br/>
            {stats_website_users}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.badHeaderList.fe_users, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.badHeaderList.PLAINLIST}">
            <br/>
            {stats_plainlist}
            <ul>
                <li>
                    <f:format.html>{dataStats.tables.6.badHeaderList.PLAINLIST.PLAINLIST}</f:format.html>
                </li>
            </ul>
        </f:if>

        <f:comment>badHeaderDisable</f:comment>

        <f:if condition="{dataStats.tables.6.badHeaderDisable.tt_address}">
            <br/>
            {dataStats.tables.6.badHeaderDisable.tt_address.rows -> f:count()} {stats_emails_disabled}
        </f:if>
        <f:if condition="{dataStats.tables.6.badHeaderDisable.fe_users}">
            <br/>
            {dataStats.tables.6.badHeaderDisable.fe_users.rows -> f:count()} {stats_website_users_disabled}
        </f:if>

        <f:comment>badHeaderCSV</f:comment>

        <f:if condition="{dataStats.tables.6.badHeaderCSV}">
            <br/>
            <f:translate key="{lll}stats_emails_returned_bad_header_list"/>
            <br/>
            <textarea style="width:460px;" rows="6" name="nothing"><f:format.html>{dataStats.tables.6.badHeaderCSV.text}</f:format.html></textarea>
        </f:if>

        <f:comment>reasonUnknownList</f:comment>

        <f:if condition="{dataStats.tables.6.reasonUnknownList.tt_address}">
            <br/>
            {stats_emails}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.reasonUnknownList.tt_address, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.reasonUnknownList.fe_users}">
            <br/>
            {stats_website_users}
            <br/>
            <f:render arguments="{table: dataStats.tables.6.reasonUnknownList.fe_users, lll:lll}"
                      section="returnConfig"/>
        </f:if>
        <f:if condition="{dataStats.tables.6.reasonUnknownList.PLAINLIST}">
            <br/>
            {stats_plainlist}
            <ul>
                <li>
                    <f:format.html>{dataStats.tables.6.reasonUnknownList.PLAINLIST.PLAINLIST}</f:format.html>
                </li>
            </ul>
        </f:if>

        <f:comment>reasonUnknownDisable</f:comment>

        <f:if condition="{dataStats.tables.6.reasonUnknownDisable.tt_address}">
            <br/>
            {dataStats.tables.6.reasonUnknownDisable.tt_address.rows -> f:count()} {stats_emails_disabled}
        </f:if>
        <f:if condition="{dataStats.tables.6.reasonUnknownDisable.fe_users}">
            <br/>
            {dataStats.tables.6.reasonUnknownDisable.fe_users.rows -> f:count()} {stats_website_users_disabled}
        </f:if>

        <f:comment>reasonUnknownCSV</f:comment>

        <f:if condition="{dataStats.tables.6.reasonUnknownCSV}">
            <br/>
            <f:translate key="{lll}stats_emails_returned_reason_unknown_list"/>
            <br/>
            <textarea style="width:460px;" rows="6" name="nothing"><f:format.html>{dataStats.tables.6.reasonUnknownCSV.text}</f:format.html></textarea>
        </f:if>
    </f:if>

</f:section>

<f:section name="table">
    <div class="panel panel-default mb-3">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <f:for each="{table.head}" as="head">
                    <th>
                        <f:if condition="{head}">
                            <f:translate key="{lll}{head}"/>
                        </f:if>
                    </th>
                </f:for>
            </tr>
            </thead>
            <tbody>
            <f:for each="{table.body}" as="body">
                <tr>
                    <f:for each="{body}" as="cell" iteration="fooIterator">
                        <f:if condition="{fooIterator.isFirst}">
                            <f:then>
                                <th>
                                    <f:translate key="{lll}{cell}" default="{cell}"/>
                                </th>
                            </f:then>
                            <f:else>
                                <td>
                                    <f:format.html>{cell}</f:format.html>
                                </td>
                            </f:else>
                        </f:if>
                    </f:for>
                </tr>
            </f:for>
            </tbody>
        </table>
    </div>
</f:section>

<f:section name="ReturnedMails">
    <div class="panel panel-default mb-3">
        <table class="table table-striped table-hover">
            <tbody>
            <f:for each="{table.body}" as="tr">
                <tr>
                    <th class="col-title col-responsive nowrap">
                        <f:translate key="{lll}{tr.title}"/>
                    </th>
                    <td class="text-center">{tr.rows -> f:count()}</td>
                    <td class="col-control nowrap">
                        <f:if condition="{tr.rows}">
                            <div class="btn-group">
                                <f:for each="{tr.icons}" as="icon">
                                    <a href="{table.url}&{icon.getAttr}=1" class="btn btn-default"
                                       title="{f:translate(key: '{lll}{icon.lang}')}">
                                        <span class="t3js-icon icon icon-size-small icon-state-default">
                                            <f:format.html>{icon.icon}</f:format.html>
                                        </span>
                                    </a>
                                </f:for>
                            </div>
                        </f:if>
                    </td>
                </tr>
            </f:for>
            </tbody>
        </table>
    </div>
</f:section>


<f:section name="returnConfig">
    <f:if condition="{table.returnConfig.rows}">
        <p>{f:translate(key: '{lll}dmail_number_records')} <span class="badge rounded-pill bg-primary">{table.returnConfig.rows -> f:count()}</span>
        </p>
        <div class="panel panel-default mb-3">
            <table class="table table-striped table-hover">
                <tbody>
                <f:for each="{table.returnConfig.rows}" as="row">
                    <tr>
                        <td class="col-icon nowrap">
                            <f:format.html>{row.icon}</f:format.html>
                        </td>
                        <td class="col-control nowrap">
                            <f:if condition="{row.uid} && {table.returnConfig.edit}">
                                <be:link.editRecord class="btn btn-default" uid="{row.uid}" table="{table.table}"
                                                    title="{f:translate(key: '{lll}dmail_edit')}">
                                    <core:icon identifier="actions-open"/>
                                </be:link.editRecord>
                            </f:if>
                            </a></td>
                        <td class="nowrap">
                            {row.email}
                        </td>
                        <td class="nowrap">
                            {row.name}
                        </td>
                    </tr>
                </f:for>
                </tbody>
            </table>
        </div>
    </f:if>
</f:section>
</html>
