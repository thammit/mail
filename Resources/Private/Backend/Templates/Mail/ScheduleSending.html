<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"
      xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:mail="http://typo3.org/ns/MEDIAESSENZ/Mail/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Default"/>

<f:section name="content">
    <f:variable name="lll" value="LLL:EXT:mail/Resources/Private/Language/Modules.xlf:"/>
    <h1><f:translate key="{lll}mail.wizard.title"/></h1>
    <f:render partial="Wizard/Steps" arguments="{navigation: navigation}"/>
    <h2><core:iconForRecord row="{uid: mailUid, type:0}" table="tx_mail_domain_model_mail" size="default"/> {title}</h2>
    <h3><f:translate key="{lll}mail.wizard.scheduleSending"/></h3>
    <f:form action="finish" object="{mail}" objectName="mail" method="post" enctype="multipart/form-data">
        <div class="mb-4">
            <f:be.infobox state="-1" title="{f:translate(key: '{lll}mail.wizard.scheduleSending.info.mailGroup.title')}">
                <f:format.nl2br><f:translate key="{lll}mail.wizard.scheduleSending.info.mailGroup.message"/></f:format.nl2br>
            </f:be.infobox>
            <f:if condition="{groups}">
                <f:then>
                    <f:variable name="numberOfRecipientGroups" value="{groups -> f:count()}"/>
                    <f:if condition="{numberOfRecipientGroups} == 1">
                        <f:then>
                            <f:variable name="group">{groups.0}</f:variable>
                            <f:form.hidden property="recipientGroups" value="{group.uid}"/>
                            <label class="form-label h4 mb-2">
                                <f:translate key="{lll}mail.wizard.scheduleSending.mailGroup"/>
                            </label>
                            <ul>
                                <li title="{group.uid}">{group.title}
                                    <f:if condition="{group.receiver}"><span class="badge rounded-pill bg-mail-theme ms-1 pb-1">{group.receiver}</span></f:if>
                                </li>
                            </ul>
                        </f:then>
                        <f:else>
                            <div class="mb-3 row">
                                <div class="col-12 col-md-6 col-lg-3">
                                    <h4>
                                        <f:translate key="{lll}mail.wizard.scheduleSending.mailGroups"/>
                                    </h4>
                                    <f:for each="{groups}" as="group">
                                        <div class="form-check">
                                            <f:form.checkbox class="form-check-input" property="recipientGroups" multiple="1" value="{group.uid}" id="mailgroups-{group.uid}"/>
                                            <label class="form-check-label" for="mailgroups-{group.uid}">
                                                {group.title} <span class="badge rounded-pill bg-mail-theme ms-1 pb-1">{group.receiver}</span>
                                            </label>
                                        </div>
                                    </f:for>
                                </div>
                            </div>
                        </f:else>
                    </f:if>
                </f:then>
                <f:else>
                    <f:be.infobox state="2">
                        <f:translate key="{lll}mail.wizard.scheduleSending.noRecipientGroupsFound.message"/>
                    </f:be.infobox>
                </f:else>
            </f:if>
            <div class="mb-4 row">
                <div class="col-12 col-md-6 col-lg-4">
                    <label for="distributionTime" class="form-label h4 mb-2">
                        <f:translate key="{lll}mail.wizard.scheduleSending.distributionTime"/>
                    </label>
                    <div class="input-group">
                        <f:form.textfield additionalAttributes="{autocomplete:'off'}" data="{date-type:'datetime'}" class="form-control t3js-datetimepicker t3js-clearable" id="distributionTime"
                               property="scheduled" value="{f:format.date(format:'H:i d-m-Y', date:'now')}"/>
                        <label class="mb-0 btn btn-default" for="distributionTime">
                            <span class="t3js-icon icon icon-size-small icon-state-default icon-actions-calendar" data-identifier="actions-calendar">
                                <span class="icon-markup">
                                    <svg class="icon-color"><use xlink:href="/typo3/sysext/core/Resources/Public/Icons/T3Icons/sprites/actions.svg#actions-calendar"/></svg>
                                </span>
                            </span>
                        </label>
                    </div>
                </div>
            </div>
            <f:comment>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" name="isTestMail" id="tx-directmail-sendtestmail-check" value="1"/>
                    <label class="form-check-label" for="tx-directmail-sendtestmail-check">
                        <f:translate key="{lll}mail.wizard.scheduleSending.testMail"/>
                    </label>
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" name="saveDraft" id="tx-directmail-savedraft-check" value="1"/>
                    <label class="form-check-label" for="tx-directmail-savedraft-check">
                        <f:translate key="{lll}mail.wizard.scheduleDraft"/>
                    </label>
                </div>
            </f:comment>
            <f:form.button class="btn btn-lg btn-mail-theme text-uppercase" type="Submit">
                <f:translate key="{lll}general.button.finish"/>
            </f:form.button>
        </div>
    </f:form>
    <f:render partial="Wizard/Navigation" arguments="{mail:mailUid, previousAction: navigation.previousAction, lll:lll}"/>
</f:section>
</html>
