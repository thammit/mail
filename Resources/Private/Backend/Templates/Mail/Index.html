<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"
      xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:mail="http://typo3.org/ns/MEDIAESSENZ/Mail/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Default"/>

<f:section name="content">
    <f:variable name="lll" value="LLL:EXT:mail/Resources/Private/Language/Modules.xlf:"/>
    <h1><f:translate key="{lll}mail.wizard.title"/></h1>
    <f:render partial="Wizard/Steps" arguments="{navigation: navigation}"/>
    <h2><f:translate key="{lll}mail.wizard.selectSource"/>:</h2>
    <div class="panel-group" id="mail-wizard-source-select-panel">
        <f:if condition="{panel.open.data}">
            <f:variable name="counter" value="{panel.open.data -> f:count()}"/>
            <f:variable name="title"><f:translate key="{lll}mail.wizard.openMails"/></f:variable>
            <f:render partial="Panel" arguments="{lll:lll, parentId:'mail-wizard-source-select-panel', title: title, index:7, open:panel.open.open, counter: counter}" contentAs="panelBody">
                <f:render section="OpenMailsPanel" arguments="{lll:lll, data: panel.open, mailSysFolderUid:mailSysFolderUid}" />
            </f:render>
        </f:if>
        <f:if condition="{panel.internal}">
            <f:variable name="counter" value="{panel.internal.data -> f:count()}"/>
            <f:variable name="title"><f:translate key="{lll}mail.wizard.internalPage"/></f:variable>
            <f:variable name="additionalHeading"><core:icon identifier="app-pagetree-folder-contains-mail" /> {pageInfo.title} [{pageInfo.uid}]</f:variable>
            <f:render partial="Panel" arguments="{lll:lll, parentId:'mail-wizard-source-select-panel', title: title, index:4, open:panel.internal.open, counter: counter, additionalHeading: additionalHeading}" contentAs="panelBody">
                <f:render section="InternalPanel" arguments="{lll:lll, data: panel.internal, mailSysFolderUid:mailSysFolderUid}" />
            </f:render>
        </f:if>
        <f:if condition="{panel.external}">
            <f:variable name="title"><f:translate key="{lll}mail.wizard.externalPage"/></f:variable>
            <f:render partial="Panel" arguments="{lll:lll, parentId:'mail-wizard-source-select-panel', title: title, index:5, open:panel.external.open, counter: 0}" contentAs="panelBody">
                <f:render section="ExternalPanel" arguments="{lll:lll, settings: settings, data: panel.external}" />
            </f:render>
        </f:if>
        <f:if condition="{panel.quickMail}">
            <f:variable name="title"><f:translate key="{lll}mail.wizard.quickMail"/></f:variable>
            <f:render partial="Panel" arguments="{lll:lll, parentId:'mail-wizard-source-select-panel', title: title, index:6, open:panel.quickMail.open, counter: 0}" contentAs="panelBody">
                <f:render section="QuickMailPanel" arguments="{lll:lll, settings: settings, data: panel.quickMail}" />
            </f:render>
        </f:if>
    </div>
    <div class="t3js-modal modal fade modal-type-default modal-severity-notice modal-style-default modal-size-medium" id="previewModal">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="t3js-modal-content modal-content">
                <div class="modal-header">
                    <h4 class="t3js-modal-title modal-title"></h4>
                    <button class="t3js-modal-close close" data-bs-dismiss="modal" aria-label="Close">
                        <core:icon identifier="actions-close" />
                        <span class="visually-hidden">Close</span>
                    </button>
                </div>
                <div class="t3js-modal-body modal-body">
                    <iframe width="100%" height="440" title="Mail Preview" frameborder="0"></iframe>
                </div>
            </div>
        </div>
    </div>
</f:section>

<f:section name="previewButtons">
    <f:variable name="previewLinks" value="{mail:previewLinks(uid:uid,pageId:pageId)}"/>
    <f:for each="{previewLinks}" as="previewLinks" key="type">
        <f:if condition="{type} == 'htmlPreview'">
            <f:variable name="addIconOverlay" value="0" />
            <f:if condition="{previewLinks -> f:count()} > 1">
                <f:variable name="addIconOverlay" value="1" />
            </f:if>
            <f:for each="{previewLinks}" as="htmlPreviewLink">
                <f:variable name="overlay" value="" />
                <f:if condition="{addIconOverlay}">
                    <f:variable name="iconOverlay" value="{htmlPreviewLink.flagIcon}" />
                </f:if>
                <a href="{htmlPreviewLink.uri}" class="js-mail-preview-modal btn btn-default" title="{htmlPreviewLink.title}" data-bs-toggle="modal" data-bs-target="#previewModal" data-modal-title="{data.title}"><core:icon identifier="mail-preview-html" overlay="{iconOverlay}" size="small"/></a>
            </f:for>
        </f:if>
        <f:if condition="{type} == 'textPreview'">
            <f:variable name="addIconOverlay" value="0" />
            <f:if condition="{previewLinks -> f:count()} > 1">
                <f:variable name="addIconOverlay" value="1" />
            </f:if>
            <f:for each="{previewLinks}" as="textPreviewLink">
                <f:variable name="overlay" value="" />
                <f:if condition="{addIconOverlay}">
                    <f:variable name="iconOverlay" value="{textPreviewLink.flagIcon}" />
                </f:if>
                <a href="{textPreviewLink.uri}" class="js-mail-preview-modal btn btn-default" title="{textPreviewLink.title}" data-bs-toggle="modal" data-bs-target="#previewModal" data-modal-title="{data.title}"><core:icon identifier="mail-preview-text" overlay="{iconOverlay}" size="small"/></a>
            </f:for>
        </f:if>
    </f:for>
</f:section>

<f:section name="OpenMailsPanel">
    <f:variable name="lllTypePrefix" value="LLL:EXT:mail/Resources/Private/Language/locallang_tca.xlf:tx_mail_domain_model_mail.type.I." />
    <div class="panel panel-default">
        <table class="table table-striped table-hover">
            <thead class="table-light">
            <tr>
                <th style="width: 1%">&nbsp;</th>
                <th class="col-title col-responsive nowrap"><f:translate key="{lll}mail.wizard.subject"/></th>
                <th><f:translate key="{lll}mail.wizard.type"/></th>
                <th><f:translate key="{lll}mail.wizard.lastModified"/></th>
                <th><f:translate key="{lll}mail.wizard.size"/></th>
                <th><f:translate key="{lll}mail.wizard.attachment"/></th>
                <th class="col-control nowrap"></th>
                <th class="col-control nowrap"></th>
            </tr>
            </thead>
            <tbody>
            <f:for each="{data.data}" as="data">
                <tr>
                    <td class="col-icon nowrap" style="width: 1%">
                        <core:iconForRecord row="{uid: data.uid, type:0}" table="tx_mail_domain_model_mail"/>
                    </td>
                    <td class="col-title col-responsive nowrap">
                        {data.subject}
                    </td>
                    <td class="nowrap"><f:if condition="{data.quickMail}"><f:then><f:translate key="{lll}mail.type.quickMail"/></f:then><f:else><f:translate key="{lllTypePrefix}{data.type}"/></f:else></f:if></td>
                    <td class="nowrap">{data.lastModified -> f:format.date(format:'H:i d-m-Y')}</td>
                    <td class="nowrap">{data.renderedSize -> f:format.bytes()}</td>
                    <td class="nowrap"><f:if condition="{data.attachment}">
                        <core:icon identifier="mail-attachment" size="small"/>
                    </f:if></td>
                    <td class="nowrap">
                        <f:render section="previewButtons" arguments="{uid:data.page,pageId:data.pid}" />
                        <f:if condition="!{data.scheduledBegin}">
                            <f:link.action action="delete" arguments="{mail:data.uid}" class="btn btn-default" title="Delete mail"><core:icon identifier="actions-edit-delete" size="small"/></f:link.action>
                        </f:if>
                    </td>
                    <td class="col-control nowrap">
                        <f:link.action action="openMail" arguments="{mail:data.uid}" class="btn btn-mail-theme text-uppercase"><f:translate key="{lll}general.button.next" default="Next" /></f:link.action>
                    </td>
                </tr>
            </f:for>
            </tbody>
        </table>
    </div>
</f:section>

<f:section name="InternalPanel">
    <f:if condition="{data.data}">
        <f:then>
            <f:render partial="InfoBox" arguments="{field: 'mail.wizard.internalPage'}" />
            <div class="panel panel-default">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                    <tr>
                        <th style="width: 1%"></th>
                        <th class="col-title col-responsive nowrap"><f:translate key="{lll}mail.wizard.internalPage" default="Page" /></th>
                        <th class="nowrap"></th>
                        <th class="col-control nowrap"></th>
                    </tr>
                    </thead>
                    <tbody>
                    <f:for each="{data.data}" as="data">
                        <tr class="db_list_normal">
                            <td class="col-icon nowrap" style="width: 1%"><core:icon identifier="app-pagetree-mail" size="small"/></td>
                            <td class="col-title col-responsive nowrap">{data.title}</td>
                            <td class="nowrap">
                                <a href="{be:moduleLink(route:'web_layout', arguments:'{id: data.uid}')}" class="btn btn-default" title="{f:translate(key: '{lll}general.button.edit')}">
                                    <core:icon identifier="actions-page-open" size="small"/>
                                </a>
                                <f:render section="previewButtons" arguments="{uid:data.uid,pageId:data.pid}" />
                            </td>
                            <td class="col-control nowrap">
                                <f:link.action action="createMailFromInternalPage" arguments="{page: data.uid}" class="btn btn-mail-theme text-uppercase"><f:translate key="{lll}general.button.next" default="Next" /></f:link.action>
                            </td>
                        </tr>
                    </f:for>
                    </tbody>
                </table>
            </div>
        </f:then>
        <f:else>
            <f:be.infobox state="-1" title="{f:translate(key: '{lll}mail.wizard.noMailPagesFound.title')}">
                <f:translate key="{lll}mail.wizard.noMailPagesFound.message"/>
            </f:be.infobox>
        </f:else>
    </f:if>
</f:section>

<f:section name="ExternalPanel">
    <f:render partial="InfoBox" arguments="{field: 'mail.wizard.externalPage'}" />
    <f:form action="createMailFromExternalUrls" object="external" method="post" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="externalMailHtmlUri" class="form-label"><f:translate key="{lll}configuration.externalMailHtmlUrl"/></label>
            <f:form.textfield id="externalMailHtmlUri" type="url" placeholder="https://" property="htmlUrl" name="htmlUrl" class="form-control"/>
        </div>
        <div class="mb-3">
            <label for="externalMailPlainUri" class="form-label"><f:translate key="{lll}mail.wizard.externalMailPlainTextUrl"/></label>
            <f:form.textfield id="externalMailPlainUri" type="url" placeholder="https://" property="plainUrl" name="plainTextUrl" class="form-control"/>
        </div>
        <div class="mb-3">
            <label for="subjectForExternalMail" class="form-label"><f:translate key="{lll}mail.wizard.externalMailSubject"/></label>
            <f:form.textfield id="subjectForExternalMail" type="text" placeholder="{f:translate(key: '{lll}mail.wizard.subject')}" property="subject" name="subject" class="form-control" required="1" />
        </div>
        <button class="btn btn-mail-theme text-uppercase" type="submit"><f:translate key="{lll}general.button.next" default="Next" /></button>
    </f:form>
</f:section>

<f:section name="QuickMailPanel">
    <f:render partial="InfoBox" arguments="{field: 'mail.wizard.quickMail'}" />
    <f:form action="createQuickMail" method="post" object="quickMail" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="quickmailFromName" class="form-label"><f:translate key="{lll}mail.wizard.quickmail.senderName"/></label>
            <f:form.textfield id="quickmailFromName" type="text" name="fromName" value="{data.fromName}" class="form-control" required="1" />
        </div>
        <div class="mb-3">
            <label for="quickmailFromEmail" class="form-label"><f:translate key="{lll}mail.wizard.quickmail.senderEmail"/></label>
            <f:form.textfield id="quickmailFromEmail" type="email" name="fromEmail" value="{data.fromEmail}" class="form-control" required="1" />
        </div>
        <div class="mb-3">
            <label for="quickmailSubject" class="form-label"><f:translate key="{lll}mail.wizard.externalMailSubject"/></label>
            <f:form.textfield id="quickmailSubject" type="text" name="subject" class="form-control" required="1" />
        </div>
        <div class="mb-3">
            <label for="quickmailMessage" class="form-label"><f:translate key="{lll}mail.wizard.quickmail.message"/></label>
            <f:form.textarea id="quickmailMessage" rows="10" name="message" class="form-control"></f:form.textarea>
        </div>
        <div class="form-check mb-3">
            <f:form.checkbox id="quickmailBreakLines" class="form-check-input mt-1" name="breakLines" value="1" />
            <label for="quickmailBreakLines" class="form-check-label"><f:translate key="{lll}mail.wizard.quickmail.breakLines"/></label>
        </div>
        <button class="btn btn-mail-theme text-uppercase" type="Submit"><f:translate key="{lll}general.button.next" default="Next" /></button>
    </f:form>
</f:section>
</html>
